'use strict'

# -------------------------------------------------------------------------   
class Target
  constructor: (@id,@row,@col,@data)->
  
  check: (row,col)->
    row == @row && col == @col

# ------------------------------------------------------------------------- 

dataset1 = [{"datasetid": "adt04_loisirs", "recordid": "29779b7d13e3985e103a5e95fc1eef1244cf54b1", "fields": {"adr_etab": "Route de Marseille", "lang": "fr", "commune_etab": "RIEZ", "modified": "2015-05-25", "themes": "Patrimoine culturel/Vestiges", "site_web": "www.ville-riez.fr", "id": "48571", "etat": "publi\u00e9e", "themes_ids": "THE0179", "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/1287663164000.jpg", "code_insee_etab": "04166", "titre": "BAPTISTERE - MUSEE LAPIDAIRE", "type": "PCU", "personne_fax1_etab": "04 92 77 99 07", "description_introduction": "Dans ce baptist\u00e8re \u00e9difi\u00e9 au V\u00e8me si\u00e8cle, unique en France, sont rassembl\u00e9s des vestiges gallo-romains proven\u00e7aux.\r\n\r\nDur\u00e9e moyenne de la visite : 30 mn", "personne_tel1_etab": "04 92 77 99 09", "prestations": "Parking;Parking autocar", "territoires": "Lacs et Plateaux du Verdon", "code_postal_etab": "04500", "raison_sociale_etab": "BAPTISTERE - MUSEE LAPIDAIRE", "created": "2013-07-01", "geo_point_2d": [43.818695, 6.090767], "personne_mel1_etab": "musee.riez@wanadoo.fr", "prestations_ids": "PRE0270;PRE0271"}, "geometry": {"type": "Point", "coordinates": [6.090767, 43.818695]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_loisirs", "recordid": "5643a3bb94d7e4ec13f4b807d088603d7aeb0906", "fields": {"code_postal_etab": "04500", "description_introduction": "B\u00e9n\u00e9ficiant d\u2019un soleil g\u00e9n\u00e9reux, la flore abondante et riche en nectar parfum\u00e9 des Alpes de Haute-Provence fait des collines et plateaux du d\u00e9partement un espace naturel privil\u00e9gi\u00e9 pour les abeilles et les apiculteurs. L\u2019IGP concerne tous les miels de Provence.", "personne_tel1_etab": "04 42 17 15 00", "themes_ids": "THE0191", "lang": "fr", "created": "2013-07-01", "adr_etab": "Maison des agriculteurs", "commune_etab": "RIEZ", "modified": "2015-05-25", "themes": "Produits du Terroir", "raison_sociale_etab": "Syndicat de promotion des miels de Provence-Alpes-C\u00f4te d'Azur", "personne_mel1_etab": "contact@miels-de-provence.com", "site_web": "www.miels-de-provence.com", "code_insee_etab": "04166", "titre": "Miels de Provence (I.G.P et Label Rouge)", "territoires": "Lacs et Plateaux du Verdon", "etat": "publi\u00e9e", "type": "DEG", "id": "48745", "description_presentation": "Le miel de lavande et de lavandin ainsi que les miels poly floraux de Provence, b\u00e9n\u00e9ficient par ailleurs d\u2019un label rouge. Miel proven\u00e7al par excellence le miel de lavandes, \u00e0 la consistance douce, fine et au go\u00fbt si particulier, est un enchantement.  Il est fabriqu\u00e9 par les abeilles qui tirent le nectar exclusivement des fleurs de lavande au milieu de l'\u00e9t\u00e9.Lors de votre venue en Provence, ne manquez pas de d\u00e9guster ce miel tout \u00e0 fait local."}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_loisirs", "recordid": "0e6f01cfac10ebf29223d5a82231d85f06603a89", "fields": {"code_postal_etab": "04500", "description_introduction": "Randonn\u00e9e en quad, balades sur le plateau de Valensole autour du lac de Sainte-Croix", "personne_tel1_etab": "06 09 43 17 40", "themes_ids": "THE0142", "lang": "fr", "created": "2013-07-01", "commune_etab": "RIEZ", "modified": "2015-05-25", "themes": "Activit\u00e9 Terre/Motoris\u00e9e", "raison_sociale_etab": "QUAD ESCAPE", "code_insee_etab": "04166", "personne_mel1_etab": "quad-escape.jm@wanadoo.fr", "titre": "QUAD ESCAPE", "territoires": "Lacs et Plateaux du Verdon", "etat": "publi\u00e9e", "type": "ASC", "id": "48131", "personne_tel2_etab": "06 88 80 37 20"}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_loisirs", "recordid": "a8486e846d5ca42b94647af097dcb9abb5fa5759", "fields": {"adr_etab": "Base nautique \u00e0 Montpezat", "multimedia_url_video": "http://www.youtube.com/embed/N4L6hORXCAE", "description_presentation": "Labellis\u00e9 par le Parc Naturel R\u00e9gional du Verdon pour la qualit\u00e9 de nos prestations d\u2019un point de vue de l\u2019accueil, de la d\u00e9couverte du patrimoine culturel, historique, pr\u00e9historique et naturel mais aussi pour notre respect de l\u2019environnement.\r\nNous vous proposons\u00a0:\r\nDes activit\u00e9s encadr\u00e9es (cano\u00eb kayak, vtt, randonn\u00e9e p\u00e9destre, rafting, raquette \u00e0 neige) par des moniteurs dipl\u00f4m\u00e9s d\u2019\u00e9tat, comp\u00e9tents et passionn\u00e9s ayant de nombreuses ann\u00e9es d\u2019exp\u00e9rience dans le Verdon et dans les disciplines enseign\u00e9es.\r\nUn accueil chaleureux sur notre base nautique pour les activit\u00e9s de location de cano\u00eb kayak, p\u00e9dalos\u2026\r\nPublic\u00a0: Individuel, famille (enfant \u00e0 partir de 4 ans), personne \u00e0 mobilit\u00e9 r\u00e9duite, groupe d\u2019amis, comit\u00e9 d\u2019entreprise, s\u00e9minaire, scolaire, centre de vacances et de loisirs, accueil de presse\u2026\r\nNous vous accueillons\u00a0sur l\u2019ensemble du territoire du Verdon et des Alpes de haute Provence voir sur la r\u00e9gion PACA pour les activit\u00e9s encadr\u00e9es, sur notre base nautique \u00e0 Montpezat. Au d\u00e9part de Quinson (club de cano\u00eb kayak de Quinson).", "classement_labels_ids": "LAB0068;LAB0038", "commune_etab": "MONTAGNAC-MONTPEZAT", "modified": "2015-05-25", "multimedia_credits": ";;;;", "site_web": "http://www.aquattitude.com", "classement_labels": "Parc Naturel R\u00e9gional;Qualit\u00e9 Tourisme", "id": "48217", "lang": "fr", "etat": "publi\u00e9e", "description_complementaire": "Toutes nos activit\u00e9s se font uniquement sur RESERVATION.\r\nPour tous renseignements ou devis nous contacter.\r\nMarque Parc.", "themes_ids": "THE0106;THE0109;THE0115;THE0121;THE0143;THE0145;THE0153", "altitude": 413.405059814, "raison_sociale_etab": "AQUATTITUDE", "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/1301387584000.jpg;http://static.kap-tourisme.fr/public/medias/27/1301387744000.jpg;http://static.kap-tourisme.fr/public/medias/27/1302696553000.jpg;http://static.kap-tourisme.fr/public/medias/27/1302696602000.jpg", "personne_civilite_etab": "M", "code_insee_etab": "04124", "titre": "AQUATTITUDE", "type": "ASC", "description_introduction": "Aquattitude, une \u00e9quipe de professionnels des sports de pleine nature, vous invite \u00e0 partager leur passion dans un site unique et grandiose\u00a0: \u00ab\u00a0les gorges du Verdon\u00a0\u00bb.\r\nNotre devise \u00ab\u00a0Ressentir la nature, Vivre une aventure\u00a0\u00bb.", "personne_tel1_etab": "06 79 21 03 77", "prestations": "Accessible handicap moteur;Accessible handicap visuel;Accessible handicap auditif;Accessible handicap mental;Acc\u00e8s partiel handicap moteur", "adr_info": "Base nautique de Quinson", "territoires": "Lacs et Plateaux du Verdon", "personne_prenom_etab": "Christophe", "code_postal_etab": "04500", "themes": "Activit\u00e9 Aquatiques/Rafting;Activit\u00e9 Aquatiques/Cano\u00eb Kayak;Activit\u00e9 Aquatiques/Nage en eau vive;Activit\u00e9 Aquatiques/Randonn\u00e9e Aquatique;Activit\u00e9 Terre/Balade comment\u00e9e;Activit\u00e9 Terre/Parcours d'Orientation;Activit\u00e9 Terre/Randonn\u00e9e P\u00e9destre", "pays_etab": "FRANCE", "personne_nom_etab": "TREMEAU", "created": "2013-07-01", "geo_point_2d": [43.746359, 6.085138], "personne_mel1_etab": "aquattitude04@aliceadsl.fr", "prestations_ids": "PRE0001;PRE0002;PRE0003;PRE0004;PRE0005"}, "geometry": {"type": "Point", "coordinates": [6.085138, 43.746359]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_loisirs", "recordid": "8357086d5277367db52eaa00da4ed77a664a9253", "fields": {"adr_etab": "Le haut village", "description_presentation": "Martine CAZIN, c\u00e9ramiste et peintre ont fait le choix d'y pr\u00e9senter leur travail et les oeuvres des artistes de leur r\u00e9gion, entretenant avec eux un dialogue constant.\r\n\r\nAbstraits ou figuratifs, leurs personnalit\u00e9s s'expriment dans le langage de notre \u00e9poque.\r\n\r\nUne petite biblioth\u00e8que \u00e0 la disposition des visiteurs, des rencontres avec les artistes en permettent l'approche et font de la cr\u00e9ation un lieu de partage.\r\n\r\nP\u00e9riode d'Ouverture \r\n\r\nMai: tous les jours, de 15 \u00e0 19 h et sur rendez-vous\r\nJuillet : tous les jours, de 15 \u00e0 19 H et sur rendez-vous\r\nAo\u00fbt : tous les jours, de 15 \u00e0 19 H et sur rendez-vous\r\n\r\nParking \u00e0 la Rotonde", "commune_etab": "SIMIANE-LA-ROTONDE", "modified": "2015-05-25", "themes": "Mus\u00e9e exposition et observatoire/Mus\u00e9e exposition, observatoires;Patrimoine culturel/Patrimoine culturel", "site_web": "http://www.lamaisondebrian.fr", "id": "48439", "lang": "fr", "etat": "publi\u00e9e", "themes_ids": "THE0170;THE0171", "altitude": 705.231384277, "raison_sociale_etab": "LA MAISON DE BRIAN - ART CONTEMPORAIN", "code_insee_etab": "04208", "titre": "LA MAISON DE BRIAN - ART CONTEMPORAIN", "type": "PCU", "description_introduction": "Quand le Luberon s'\u00e9tire vers la Haute - Provence mythique de Giono, on arrive \u00e0 SIMIANE-LA-ROTONDE.\r\nUn jour gris de novembre 1964, un anglais amoureux de la France, Brian Featherstone, pose sa malle et ses livres dans l'ancienne maison du cordonnier.\r\nTraducteur aux Nations Unies, \u00e9crivain et berger au pays, cet homme de dialogue participera activement pendant toute son existence au renouveau du village.\r\n\r\nSa maison fut toujours ouverte aux artistes.\r\nEt aujourd'hui, dans le d\u00e9dale de pierre, l'ancienne et chaleureuse maison de Brian se consacre \u00e0 l'art contemporain et invite \u00e0 partager l'aventure de la modernit\u00e9.", "personne_tel1_etab": "04 92 75 91 49", "adherent": "forcalquier", "prestations": "Parking;Parking;Parking mort;Parking mort", "bureau_distrib_etab": "SIMIANE-LA-ROTONDE", "territoires": "Manosque - Forcalquier en Haute Provence", "code_postal_etab": "04150", "pays_etab": "FRANCE", "created": "2013-07-01", "geo_point_2d": [43.981081, 5.55876], "personne_mel1_etab": "lamaisondebrian@orange.fr", "prestations_ids": "PRE0270;PRE0270;PRE0272;PRE0272"}, "geometry": {"type": "Point", "coordinates": [5.55876, 43.981081]}, "record_timestamp": "2015-05-25T20:00:05+02:00"}]
    
   
dataset2 = [{"datasetid": "adt04_fetes_animations", "recordid": "26464b245fa980a0910160ee825c4c0edba1caed", "fields": {"lang": "fr", "etat": "publi\u00e9e", "description_presentation": "Rendez-vous \u00e0 10h \u00e0 l'Office de Tourisme\nTarif : 3\u20ac par personne, gratuit pour les moins de 12 ans", "created": "2015-05-22", "periode_date_fin_1": "2015-08-18", "modified": "2015-05-25", "periode_nom_1": "Ouverture", "periode_date_debut_1": "2015-08-18", "titre": "Visite guid\u00e9e du village", "type": "FMA", "id": "56331"}, "record_timestamp": "2015-05-25T15:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "94d47887c708110b4c597525ecacd7b2d169ec1a", "fields": {"adr_etab": "Place de la Mairie", "personne_tel2_info": "06 84 58 71 10", "lang": "fr", "raison_sociale_info": "Riez Animation", "commune_etab": "RIEZ", "modified": "2015-05-25", "themes": "Animations Locales/March\u00e9 et march\u00e9 nocturne", "site_web": "http://www.ville-riez.fr/", "periode_date_debut_1": "2015-07-02", "id": "46653", "personne_tel1_info": "04 92 74 88 97", "themes_ids": "THE0032", "periode_detail_1": "Tous les jeudis soir de 18h00 \u00e0 minuit", "altitude": 528.825805664, "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/1i9yp7dfg1s947abopfnyeoo-mime-image-2fjpeg-originalname-march-c3-a9-1.jpg-geometry-270-3e", "code_insee_etab": "04166", "titre": "MARCH\u00c9 NOCTURNE", "type": "FMA", "description_introduction": "Tous les jeudis soir de 18h00 \u00e0 minuit \nAnimation musicale. \nSur la place du Quinconce.", "personne_tel1_etab": "04 92 77 99 09", "periode_date_fin_1": "2015-08-27", "periode_nom_1": "Dates", "territoires": "Lacs et Plateaux du Verdon", "etat": "publi\u00e9e", "code_postal_etab": "04500", "raison_sociale_etab": "Bureau du Tourisme", "created": "2014-07-31", "geo_point_2d": [43.817515, 6.092958], "personne_mel1_etab": "tourisme.riez@wanadoo.fr"}, "geometry": {"type": "Point", "coordinates": [6.092958, 43.817515]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "0db56be57fa5a2bec66ac6ab266879c7fc849ad3", "fields": {"adr_etab": "All\u00e9e Louis Gardiol", "description_presentation": "March\u00e9 du terroir et artisanat, Vide-grenier,d\u00e9monstration de tonte des moutons, passage des moutons dans le village, animations musicales et folkloriques, mechoui.", "langues_ids": "LAN0004", "commune_etab": "RIEZ", "modified": "2015-05-25", "multimedia_credits": "Bureau du Tourisme", "site_web": "http://www.ville-riez.fr", "periode_date_debut_1": "2015-06-21", "id": "46873", "etat": "publi\u00e9e", "themes_ids": "THE0014;THE0015;THE0034;THE0004", "altitude": 528.496765137, "raison_sociale_etab": "F\u00caTE DE LA TRANSHUMANCE", "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/f-c3-aates-20005.jpg", "code_insee_etab": "04166", "titre": "F\u00caTE DE LA TRANSHUMANCE", "type": "FMA", "lang": "fr", "personne_tel1_etab": "04.92.77.99.09", "periode_date_fin_1": "2015-06-21", "periode_nom_1": "F\u00caTE DE LA TRANSHUMANCE", "cedex_etab": "04500", "territoires": "Lacs et Plateaux du Verdon", "code_postal_etab": "04500", "themes": "Animations Locales;Animations Locales/artisanat;Animations Locales/Folklore;Ev\u00e8nements/Exposition", "pays_etab": "FRANCE", "created": "2014-06-06", "geo_point_2d": [43.817387, 6.093344], "personne_mel1_etab": "tourisme.riez@wanadoo.fr", "langues": "Fran\u00e7ais"}, "geometry": {"type": "Point", "coordinates": [6.093344, 43.817387]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "c1e027db5b22d7245ae892119c8e83261b8b8e75", "fields": {"description_presentation": "Exposition organis\u00e9e par la Maison de Brian, galerie d'art contemporain \u00e0 Simiane-la-Rotonde.", "raison_sociale_info": "Ch\u00e2teau m\u00e9di\u00e9val", "langues_ids": "LAN0002;LAN0004", "commune_etab": "SIMIANE-LA-ROTONDE", "modified": "2015-05-25", "themes": "Animations Locales/Art Graphique Art Plastique;Ev\u00e8nements/Exposition", "date_fin": "2015-07-30", "site_web": "http://www.jo-winter.de/jo-winter.html", "periode_date_debut_1": "2015-06-27", "date_debut": "2015-03-15", "lang": "fr", "personne_tel1_info": "0492731134", "description_complementaire": "Vernissage le samedi 27 juin \u00e0 18h.", "themes_ids": "THE0016;THE0004", "periode_detail_1": "Inclus dans la visite du ch\u00e2teau m\u00e9di\u00e9val, entr\u00e9e payante", "altitude": 715.134155273, "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/jo-20winter.jpg", "id": "47749", "tarif_description_1": "4.50 \u20ac - Entr\u00e9e adulte", "code_insee_etab": "04208", "tarif_nom_1": "Tarif", "titre": "Exposition - Jo Winter", "type": "FMA", "description_introduction": "Sculpture sur bois", "personne_tel1_etab": "0492759149", "moyenspaiement": "Cartes de cr\u00e9dit;Ch\u00e8ques;Esp\u00e8ces", "prestations": "Parking;Toilettes", "personne_mel1_info": "contact@simiane-la-rotonde.fr", "periode_date_fin_1": "2015-07-28", "periode_nom_1": "Jo Winter", "adr_info": "Le haut village", "territoires": "Manosque - Forcalquier en Haute Provence", "etat": "publi\u00e9e", "code_postal_etab": "04150", "raison_sociale_etab": "La maison de Brian", "created": "2015-03-15", "geo_point_2d": [43.981349, 5.561328], "site_reservation": "www.simiane-la-rotonde.fr", "personne_mel1_etab": "lamaisondebrian@orange.fr", "tarif_devise_1": "\u20ac", "prestations_ids": "PRE0270;PRE0208", "langues": "English;Fran\u00e7ais"}, "geometry": {"type": "Point", "coordinates": [5.561328, 43.981349]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "e7422b7e74649a52fe6e33d8ad9d2d2489c2e2bc", "fields": {"lang": "fr", "raison_sociale_info": "Ch\u00e2teau m\u00e9di\u00e9val", "commune_etab": "SIMIANE-LA-ROTONDE", "modified": "2015-05-25", "themes": "Animations Locales/Culture;Ev\u00e8nements/Exposition", "date_fin": "2015-11-12", "site_web": "www.simiane-la-rotonde.fr", "periode_date_debut_1": "2015-05-09", "date_debut": "2015-03-15", "personne_tel1_info": "0492731134", "themes_ids": "THE0022;THE0004", "periode_detail_1": "Inclus dans la visite du ch\u00e2teau m\u00e9di\u00e9val, entr\u00e9e payante", "altitude": 715.134155273, "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/32/affiche-marie-d-agoult.jpg", "id": "47655", "tarif_description_1": "4.50 \u20ac - Entr\u00e9e adulte", "code_insee_etab": "04208", "tarif_nom_1": "Tarif", "titre": "Exposition - Marie d'Agoult alias Daniel Stern", "type": "FMA", "description_introduction": "Cette exposition est la premi\u00e8re d'une s\u00e9rie consacr\u00e9e aux grandes figures f\u00e9minines de la famille Agoult-Simiane.", "moyenspaiement": "Cartes de cr\u00e9dit;Ch\u00e8ques;Esp\u00e8ces", "prestations": "Parking;Toilettes", "personne_mel1_info": "contact@simiane-la-rotonde.fr", "periode_date_fin_1": "2015-11-11", "periode_nom_1": "Marie d'Agoult alias Daniel Stern", "adr_info": "Le haut village", "territoires": "Manosque - Forcalquier en Haute Provence", "etat": "publi\u00e9e", "code_postal_etab": "04150", "created": "2015-03-15", "geo_point_2d": [43.981349, 5.561328], "tarif_devise_1": "\u20ac", "prestations_ids": "PRE0270;PRE0208"}, "geometry": {"type": "Point", "coordinates": [5.561328, 43.981349]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "aaff0711944d278201bcafbcd2c7dd554e02b8eb", "fields": {"code_postal_etab": "04240", "lang": "fr", "personne_tel1_etab": "04 92 83 20 16", "pays_etab": "FRANCE", "commune_etab": "LE FUGERET", "created": "2013-07-01", "periode_date_fin_1": "2015-07-06", "geo_point_2d": [44.004011, 6.640169], "modified": "2015-05-25", "themes": "Animations Locales/F\u00eate de Village Traditionnelle (dont procession religieuse)", "bureau_distrib_etab": "LE FUGERET", "raison_sociale_etab": "Comit\u00e9 des f\u00eates", "titre": "FETE PATRONALE DE SAINT PIERRE", "code_insee_etab": "04090", "personne_mel1_etab": "le.fugeret.mairie@wanadoo.fr", "periode_date_debut_1": "2015-07-04", "themes_ids": "THE0031", "territoires": "Autour des Gorges du Verdon", "etat": "publi\u00e9e", "type": "FMA", "id": "47368"}, "geometry": {"type": "Point", "coordinates": [6.640169, 44.004011]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "fe76fe0286a723db91c2d3a9b190392cd4e2bcd9", "fields": {"description_introduction": "Au programme, march\u00e9 de la ch\u00e2taigne, inauguration officielle avec la Confr\u00e9rie des amis de la ch\u00e2taigne, messe, repas \u00e0 base de ch\u00e2taigne, animations ...", "commune_etab": "LE FUGERET", "modified": "2015-05-25", "multimedia_credits": "Comit\u00e9 des f\u00eates du Fugeret;Comit\u00e9 des f\u00eates du Fugeret;Comit\u00e9 des f\u00eates du Fugeret", "periode_date_debut_1": "2015-11-07", "id": "47475", "etat": "publi\u00e9e", "themes_ids": "THE0001;THE0032", "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/chataigne03mini.jpg;http://static.kap-tourisme.fr/public/medias/27/chataigne06.jpg;http://static.kap-tourisme.fr/public/medias/27/p03.jpg", "personne_mel1_etab": "le.fugeret.mairie@wanadoo.fr", "code_insee_etab": "04090", "titre": "FETE DE LA CHATAIGNE", "type": "FMA", "lang": "fr", "personne_tel1_etab": "04 92 83 20 16", "periode_date_fin_1": "2015-11-07", "bureau_distrib_etab": "LE FUGERET", "pays_etab": "FRANCE", "code_postal_etab": "04240", "themes": "Ev\u00e8nements/Festival-F\u00eate;Animations Locales/March\u00e9 et march\u00e9 nocturne", "raison_sociale_etab": "Comit\u00e9 des f\u00eates", "created": "2013-07-01", "geo_point_2d": [44.004011, 6.640169], "territoires": "Autour des Gorges du Verdon"}, "geometry": {"type": "Point", "coordinates": [6.640169, 44.004011]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "e440ad687abd98d0a43c33e176537cebbddd91bc", "fields": {"adr_etab": "Grand Place du March\u00e9", "lang": "fr", "commune_etab": "ANNOT", "modified": "2015-05-25", "themes": "Animations Locales/March\u00e9 et march\u00e9 nocturne", "site_web": "www.annot.com", "periode_date_debut_1": "2015-10-13", "id": "47476", "etat": "publi\u00e9e", "themes_ids": "THE0032", "altitude": 700.0, "personne_mel1_etab": "info@annot.com", "code_insee_etab": "04008", "titre": "FOIRE D'AUTOMNE", "type": "FMA", "description_introduction": "Foire tous produits", "personne_tel1_etab": "04 92 83 22 09", "periode_date_fin_1": "2015-10-13", "bureau_distrib_etab": "ANNOT", "pays_etab": "FRANCE", "code_postal_etab": "04240", "raison_sociale_etab": "Mairie", "created": "2013-07-01", "geo_point_2d": [43.965886, 6.667113], "territoires": "Autour des Gorges du Verdon"}, "geometry": {"type": "Point", "coordinates": [6.667113, 43.965886]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "cc7263c08609321b36aa4615be84d8bc9969839d", "fields": {"lang": "fr", "commune_etab": "ANNOT", "modified": "2015-05-25", "multimedia_credits": "L. Bourgue / Nice Matin", "date_fin": "2015-12-31", "periode_date_debut_1": "2015-08-09", "date_debut": "2015-01-27", "etat": "publi\u00e9e", "themes_ids": "THE0029", "altitude": 700.0, "raison_sociale_etab": "Syndicat d'initiative", "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/1329389664000.jpg", "personne_civilite_etab": "M", "code_insee_etab": "04008", "titre": "BROCANTE", "type": "FMA", "description_introduction": "Brocanteurs et antiquaires professionels de la r\u00e9gion s'installent sur la grand place du march\u00e9, toute la journ\u00e9e.", "personne_tel1_etab": "04 92 83 21 49", "periode_date_fin_1": "2015-08-09", "bureau_distrib_etab": "ANNOT", "territoires": "Autour des Gorges du Verdon", "personne_prenom_etab": "Pierre", "code_postal_etab": "04240", "themes": "Animations Locales/Brocantes", "pays_etab": "FRANCE", "personne_nom_etab": "Olivier", "created": "2013-07-01", "geo_point_2d": [43.966368, 6.666861], "id": "47555"}, "geometry": {"type": "Point", "coordinates": [6.666861, 43.966368]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "0cbd654dbe1619980ec8b7ff299770e4bbc1d968", "fields": {"adr_etab": "Place du germe", "pays_info": "FRANCE", "commune_etab": "ANNOT", "modified": "2015-05-25", "themes": "Animations Locales/Braderie Vide Grenier", "periode_date_debut_1": "2015-09-20", "id": "47834", "lang": "fr", "etat": "publi\u00e9e", "themes_ids": "THE0028", "bureau_distrib_info": "ANNOT", "altitude": 691.518859863, "raison_sociale_etab": "Office de Tourisme", "code_insee_etab": "04008", "titre": "VIDE GRENIER", "type": "FMA", "description_introduction": "Toute la journ\u00e9e, grand place du march\u00e9", "personne_tel1_etab": "04 92 83 23 03", "periode_date_fin_1": "2015-09-20", "bureau_distrib_etab": "ANNOT", "territoires": "Autour des Gorges du Verdon", "code_postal_etab": "04240", "pays_etab": "FRANCE", "created": "2013-07-01", "geo_point_2d": [43.96609, 6.66699], "personne_mel1_etab": "accueil@annot-tourisme.com"}, "geometry": {"type": "Point", "coordinates": [6.66699, 43.96609]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "83b740884de32b6e62c8f9e4dc197e88658e183d", "fields": {"adr_etab": "Place Fr\u00e9d\u00e9ric Mistral", "multimedia_url_video": "http://www.youtube.com/embed/QtsthiAoqpc", "description_presentation": "Un trail qui en fonction de l'altitude, sentira bon la lavande et le g\u00e9n\u00e9pi, le parfum des sous bois et des alpages, l'air pur et vif des cimes et des grands espaces de montagne aux couleurs et ciel proven\u00e7ales.\r\n\r\nTous les ingr\u00e9dients sont r\u00e9unis pour permettre \u00e0 votre potentiel physique et technique de s'exprimer pleinement et vous amener, sur les plus hauts sommets de la Vall\u00e9e de l'Ubaye, sous l'\u0153il intrigu\u00e9 des marmottes, des chamois et bouquetins.", "commune_etab": "BARCELONNETTE", "modified": "2015-05-25", "multimedia_credits": "Athletic club Ubaye;Athletic club Ubaye", "site_web": "http://www.trailubayesalomon.com/", "periode_date_debut_1": "2015-08-09", "id": "46803", "lang": "fr", "etat": "publi\u00e9e", "description_complementaire": "Rendez-vous place Fr\u00e9d\u00e9ric Mistral pour d\u00e9couvrir les stands du trail et les animations, ainsi que pour r\u00e9cup\u00e9rer votre dossard. En cas de mauvais de temps, elle aura lieu \u00e0 la salle du march\u00e9 couvert (100m).", "themes_ids": "THE0007", "periode_detail_1": "Le 9 ao\u00fbt 2015", "social_url": "http://www.facebook.com/trailubayesalomon", "altitude": 1134.0, "multimedia_url_photo": "http://static.kap-tourisme.fr/public/medias/27/programme.jpg", "code_insee_etab": "04019", "titre": "Trail Ubaye Salomon", "type": "FMA", "description_introduction": "Le rendez-vous estival des grosses pointures et amateurs de la discipline\r\n\r\nDans une des plus belles vall\u00e9es des Alpes du Sud, berc\u00e9e par le soleil m\u00e9diterran\u00e9en, trois parcours trail, dont un trac\u00e9 \u00c9lite technique, exigeant et engag\u00e9.\r\n\r\nA chacun et chacune de choisir entre trois trac\u00e9s de 12, 23 ou 42 km en boucle, au d\u00e9part du centre ville de Barcelonnette.\r\n\r\nLe parcours \u00c9lite de 42 km, pour les dames et les hommes, est \u00e9preuve comptant pour le classement du Challenge des Trails de Provence.", "personne_tel1_etab": "04 92 81 04 71", "periode_date_fin_1": "2015-08-09", "periode_nom_1": "Date", "territoires": "Vall\u00e9e de l'Ubaye", "code_postal_etab": "04400", "themes": "Ev\u00e8nements/Sportif", "raison_sociale_etab": "Office de Tourisme", "created": "2014-07-22", "geo_point_2d": [44.3863, 6.650463]}, "geometry": {"type": "Point", "coordinates": [6.650463, 44.3863]}, "record_timestamp": "2015-05-25T20:00:05+02:00"},{"datasetid": "adt04_fetes_animations", "recordid": "785f826ba40b13d630d97d463978b2b86466dd04", "fields": {"adr_etab": "Place Fr\u00e9d\u00e9ric Mistral", "description_presentation": "Grand parcours : + 3300 m / 124 km. \r\nBarcelonnette > Col de la Cayolle (2326 m) > Col des Champs (2045 m) > Col d\u2019allos (2247 m) > Barcelonnette", "commune_etab": "BARCELONNETTE", "modified": "2015-05-25", "themes": "Ev\u00e8nements/Sportif", "site_web": "http://www.barcelonnette.com/agenda-ete/circuit-des-3-cols.html", "periode_date_debut_1": "2015-08-02", "id": "46906", "lang": "fr", "etat": "publi\u00e9e", "description_complementaire": "Petit parcours (aller/retour) : + 1700 m /   74 km. \r\nBarcelonnette > Estenc > Barcelonnette", "themes_ids": "THE0007", "periode_detail_1": "Dimanche 2 ao\u00fbt 2015", "altitude": 1134.0, "code_insee_etab": "04019", "titre": "Circuit des 3 cols", "type": "FMA", "description_introduction": "Venez vous mesurer aux cols de l'Ubaye, cols mythiques de plus de 2000 m d'altitude, au coeur du Parc du Mercantour, gardien de la biodiversit\u00e9 si riche dans la Vall\u00e9e, aux sources du Var et du Verdon.\r\nD\u00e9part : de 6h \u00e0 8h place Aim\u00e9 Gassier \u00e0 Barcelonnette. \r\nArriv\u00e9e : Parc de la sapini\u00e8re - Barcelonnette. \r\nRepas froid, boissons, fruits et caf\u00e9, remise des coupes \u00e0 15h.", "personne_tel1_etab": "04 92 81 04 71", "periode_date_fin_1": "2015-08-02", "periode_nom_1": "Date", "territoires": "Vall\u00e9e de l'Ubaye", "code_postal_etab": "04400", "raison_sociale_etab": "Office de Tourisme", "created": "2014-07-22", "geo_point_2d": [44.3863, 6.650463]}, "geometry": {"type": "Point", "coordinates": [6.650463, 44.3863]}, "record_timestamp": "2015-05-25T20:00:05+02:00"}]

angular.module 'tagatrekApp'
  .service 'Targets', ->
    
    getRandomInt = (min, max) ->
      Math.floor(Math.random() * (max - min)) + min
    
    shuffle = (array)->
      m = array.length
      while (m) 
        i = Math.floor(Math.random() * m--)
        t = array[m]
        array[m] = array[i]
        array[i] = t
      return array
    
    
    getDatasets = (callback)->
      callback([ {id:'1', name:"Loisirs"}, {id:'2', name:"Fêtes et manifestations"}])
      
    getTargets = (datasetId,lastIndex,nb)->
      getRandomTargets(getDataset(datasetId),lastIndex,nb)
      
    getDataset = (datasetId)->  
      if datasetId == "1"
        return dataset1
      else if datasetId == "2"
        return dataset2
      
      
    getRandomTargets = (datasetData,lastIndex,nb)->
      # TODO empêcher objectif au centre
      data = shuffle datasetData
      indexes = (i for i in [0..lastIndex])
      indexes = shuffle indexes
      result = []
      result.push(new Target(i+1,indexes[2*i],indexes[2*i+1],data[i])) for i in [0..nb-1]
      return result
    
    return {
      getDatasets : getDatasets,
      getTargets: getTargets
    }
